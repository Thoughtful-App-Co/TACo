# Run lint-staged for code quality
npx lint-staged

# Run gitleaks for secret detection (if installed)
if command -v gitleaks &> /dev/null; then
  echo "Running gitleaks secret detection..."
  gitleaks protect --staged --config .gitleaks.toml --verbose
  if [ $? -ne 0 ]; then
    echo "Error: gitleaks detected secrets in staged files!"
    echo "Please remove secrets before committing."
    exit 1
  fi
  echo "No secrets detected."
else
  echo "Warning: gitleaks not installed. Skipping local secret detection."
  echo "Install with: brew install gitleaks (macOS) or go install github.com/gitleaks/gitleaks/v8@latest"
fi
